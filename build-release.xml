<?xml version="1.0"?>

<project name="ELKI" default="preliminary" basedir=".">
	<property name="RELEASE" value="0.2"/>
	
	<property name="release.overview" value="release_0_2.html"/>
	
	<property name="basepackage" value="de/lmu/ifi/dbs/elki/"/>
	
	<property name="main-class" value="de.lmu.ifi.dbs.elki.KDDTask" />
	
	<property name="ELKI" value="ELKI"/>
	
	<property name="ELKI_LONG" value="ELKI: Environment for DeveLoping KDD-Applications Supported by Index-Structures"/>
	
	<tstamp>
		<format property="now" pattern="yyyy-MM-dd_HHmm" />
	</tstamp>

	<condition property="windows.disk.prefix" value="P:">
		<or>
			<equals arg1="${user.name}" arg2="achtert" />
			<equals arg1="${user.name}" arg2="schumm" />
			<equals arg1="${user.name}" arg2="wanka" />
			<and>
				<or>
					<equals arg1="${user.name}" arg2="kroegerp" />
					<equals arg1="${user.name}" arg2="zimek" />
				</or>
				<equals arg1="${os.name}" arg2="Windows XP" />
			</and>
		</or>
	</condition>

	<condition property="windows.web.prefix" value="W:">
		<or>
			<equals arg1="${user.name}" arg2="achtert" />
			<equals arg1="${user.name}" arg2="schumm" />
			<equals arg1="${user.name}" arg2="wanka" />
			<and>
				<or>
					<equals arg1="${user.name}" arg2="kroegerp" />
					<equals arg1="${user.name}" arg2="zimek" />
				</or>
				<equals arg1="${os.name}" arg2="Windows XP" />
			</and>
		</or>
	</condition>
	
	<property name="deploy.srcdir" value="${windows.disk.prefix}/nfs/infdbs/WissProj/KDD-Framework/releases/${RELEASE}/${now}/input"/>
	
	<property name="deploy.basedir" value="${windows.disk.prefix}/nfs/infdbs/WissProj/KDD-Framework/releases/${RELEASE}/${now}/output"/>
	
	<property name="deploy.target" value="${windows.web.prefix}/Forschung/KDD/ELKI/release${RELEASE}"/>

	<property name="deploy.javadoc" value="${deploy.basedir}/doc"/>

	
	<target name="preliminary" depends="copy4release,compile,javadocparams,jar"/>
	
	<target name="complete" depends="preliminary">
		<copy todir="${deploy.target}">
			<fileset dir="${deploy.basedir}"/>
		</copy>
	</target>
	
	<target name="copy4release" description="copies selected resources to current release directory">
		<copy todir="${deploy.srcdir}/src">
			<fileset dir="src">
				<exclude name="experimentalcode/**"/>
				<!-- not yet published & polished: COP -->
				<exclude name="${basepackage}algorithm/outlier/COP.*"/>
				<exclude name="${basepackage}algorithm/clustering/biclustering/**"/>
				<exclude name="${basepackage}algorithm/clustering/correlation/KernelFourC.*"/>
				<exclude name="${basepackage}algorithm/clustering/correlation/SubspaceAggregation.*"/>
				<exclude name="${basepackage}algorithm/clustering/correlation/SubspaceEM.*"/>
				<exclude name="${basepackage}converter/Arff2Txt.*"/>
				<exclude name="${basepackage}converter/ArffSparseInstanceToSparseBitVector.*"/>
				<exclude name="${basepackage}converter/Database2Arff.*"/>
				<exclude name="${basepackage}converter/Txt2Arff.*"/>
				<exclude name="${basepackage}data/synthetic/ArbitraryCorrelationGenerator.*"/>
				<exclude name="${basepackage}data/synthetic/AxesParallelCorrelationGenerator.*"/>
				<exclude name="${basepackage}data/synthetic/PartiallySimilarVoxelObjectsGenerator.*"/>
				<exclude name="${basepackage}distance/distancefunction/FractalDimensionBasedDistanceFunction"/>
                <exclude name="${basepackage}index/tree/spatial/rstarvariants/flat/**"/>
                <exclude name="${basepackage}math/analysis/**"/>
				<exclude name="${basepackage}parser/ArffFileParser.**"/>
				<exclude name="${basepackage}test/**"/>
				<!-- used only (?) by oldLOF/OnlineLOF/LOFTable/NNTable -->
                <exclude name="${basepackage}utilities/tree/btree/**"/>
				<!-- exclude wrappers currently - those are merely internal convenience classes and are a bit arbitrary, need cleaning and careful inspection -->
				<exclude name="${basepackage}wrapper/**"/>
			</fileset>			
		</copy>
		<copy todir="${deploy.javadoc}/figures">
			<fileset dir="figures/release${RELEASE}">
				<include name="*.png"/>
			</fileset>
		</copy>
	</target>
	
	
	
	<target name="compile" depends="copy4release">
		<javac destdir="${deploy.srcdir}" deprecation="true" debug="true" optimize="true" source="1.6" debuglevel="">
			<compilerarg value="-Xlint:all"/>
			<classpath path="${deploy.srcdir}/src" />
			<exclude name="*.xml" />
			<exclude name="*.html" />
			<exclude name="*.jar" />
			<exclude name="*.xsd" />
			<exclude name="*.prp" />
			<src path="${deploy.srcdir}/src" />
		</javac>
		<copy file="${deploy.srcdir}/src/${basepackage}properties/KDDFramework.prp" tofile="${deploy.srcdir}/${basepackage}properties/KDDFramework.prp"/>
	</target>
	
	<target name="jar" depends="compile">
		<jar basedir="${deploy.srcdir}/" destfile="${deploy.basedir}/elki.jar">
			<manifest>
				<attribute name="Manifest-Version" value="${RELEASE}"/>
				<attribute name="Main-class" value="${main-class}"/>
				<attribute name="Release-Date" value="${now}"/>
				<attribute name="Built-By" value="${user.name}"/>
			</manifest>
		</jar>
	</target>
	
	<target name="javadoc" depends="compile">
		<javadoc
			destdir="${deploy.javadoc}"
			access="private"
			use="true"
			notree="false"
			nonavbar="false"
			noindex="false"
			splitindex="true"
			author="true"
			version="false"
			nodeprecatedlist="false"
			nodeprecated="false"
			link="http://java.sun.com/javase/6/docs/api/"
			overview="${deploy.srcdir}/src/${release.overview}"
			classpath="${deploy.srcdir}/bin"
			doctitle="${ELKI}"
			windowtitle="${ELKI_LONG}">
			<packageset dir="${deploy.srcdir}/src"/>
			<footer>
               &lt;table style=&apos;font-size:small&apos;&gt;			
                 &lt;tr&gt;
                   &lt;td align=&apos;left&apos;&gt;
                    Release
                   &lt;/td&gt;
                   &lt;td align=&apos;center&apos;&gt;
                    ${RELEASE}
                   &lt;/td&gt;
				   &lt;td align=&apos;right&apos;&gt;
                    (${now})
                   &lt;/td&gt;
                 &lt;/tr&gt;
               &lt;/table&gt;
            </footer>
			<header>
				&lt;table cellspacing=&apos;0&apos; cellpadding=&apos;0&apos; style=&apos;font-weight:bold&#59; font-style:normal&#59; font-size:small&apos;&gt; 
				<!--				&lt;table cellspacing=&apos;0&apos; cellpadding=&apos;0&apos; style=&apos;font-weight:bold&apos;&gt;-->
				  &lt;tr&gt;
				    &lt;td align=&apos;right&apos;&gt;&lt;/td&gt;&lt;td align=&apos;center&apos;&gt;&lt;font color=&apos;#ff0000&apos;&gt;E&lt;/font&gt;&lt;/td&gt;&lt;td align=&apos;left&apos;&gt;nvironment for&lt;/td&gt;
				  &lt;/tr&gt;
				  &lt;tr&gt;
				    &lt;td align=&apos;right&apos;&gt;Deve&lt;/td&gt;&lt;td align=&apos;center&apos;&gt;&lt;font color=&apos;#ff0000&apos;&gt;L&lt;/font&gt;&lt;/td&gt;&lt;td align=&apos;left&apos;&gt;oping&lt;/td&gt;
				  &lt;/tr&gt;
				  &lt;tr&gt;
				    &lt;td align=&apos;right&apos;&gt;&lt;/td&gt;&lt;td align=&apos;center&apos;&gt;&lt;font color=&apos;#ff0000&apos;&gt;K&lt;/font&gt;&lt;/td&gt;&lt;td align=&apos;left&apos;&gt;DD-Applications&lt;/td&gt;
				  &lt;/tr&gt;
				  &lt;tr&gt;
				    &lt;td align=&apos;right&apos;&gt;Supported by&#160;&lt;/td&gt;&lt;td align=&apos;center&apos;&gt;&lt;font color=&apos;#ff0000&apos;&gt;I&lt;/font&gt;&lt;/td&gt;&lt;td align=&apos;left&apos;&gt;ndex-Structures&lt;/td&gt;
				  &lt;/tr&gt;
				&lt;/table&gt;
			</header>
		</javadoc>
		<copy todir="${deploy.javadoc}">
			<fileset dir="${source}">
				<include name="examplecalls.html"/>
			</fileset>
		</copy>
	</target>

	<target name="javadocparams" depends="copy4jar,javadoc">
	    <java classpath="${classpath}" dir="${deploy.srcdir}/bin" classname="de.lmu.ifi.dbs.elki.properties.DocumentParameters" fork="true">
	   		<arg value="${deploy.javadoc}/parameters-byclass.html"/>
	   		<arg value="${deploy.javadoc}/parameters-byopt.html"/>
	   	</java>
	</target>
</project>