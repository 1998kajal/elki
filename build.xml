<?xml version="1.0"?>

<project name="KDDFramework" default="javadoc" basedir=".">
	<tstamp>
        <format property="now"                         
                     pattern="yyyy-MM-dd_HHmm"/>
    </tstamp>

	<condition property="windows.disk.prefix" value="P:">
        <equals arg1="${user.name}" arg2="schumm"/>
    </condition>
	<condition property="windows.disk.prefix" value="">
	    <equals arg1="${user.name}" arg2="zimek"/>
	</condition>
		
    <target name="javadoc">
        <javadoc destdir="${windows.disk.prefix}/nfs/infdbs/WissProj/KDD-Framework/doc"
                 access="private"
                 use="true"
                 notree="false"
                 nonavbar="false"
                 noindex="false"
                 splitindex="true"
                 author="true"
                 version="true"
                 nodeprecatedlist="false"
                 nodeprecated="false"
                 packagenames=
    	         "de.lmu.ifi.dbs.algorithm,
                  de.lmu.ifi.dbs.caching,
    	          de.lmu.ifi.dbs.data,
                  de.lmu.ifi.dbs.data.synthetic,
				  de.lmu.ifi.dbs.database,
			      de.lmu.ifi.dbs.distance,
		          de.lmu.ifi.dbs.index.spatial,
			      de.lmu.ifi.dbs.index.spatial.rtree,
			      de.lmu.ifi.dbs.linearalgebra,
		          de.lmu.ifi.dbs.utilities,
			      de.lmu.ifi.dbs.utilities.heap,
    			  de.lmu.ifi.dbs.utilities.optionhandling,
		          de.lmu.ifi.dbs.parser"
                 overview="src/overview.html"
                 sourcepath="src"
                 classpath="bin"
                 doctitle="KDD-Framework"
                 windowtitle="KDD-Framework">
        		<footer>
        			&lt;table style="font-size:xx-small;"&gt;
        			&lt;tr&gt;
        			&lt;td colspan="2" align="left"&gt;
        			Documentation created
        			&lt;/td&gt;
        			&lt;/tr&gt;

        			&lt;tr&gt;
        			&lt;td align="left"&gt;
                    at
        			&lt;/td&gt;
        			&lt;td align="right"&gt;
        			${now}
         			&lt;/td&gt;
        			&lt;/tr&gt;

        			&lt;tr&gt;
        			&lt;td align="left"&gt;
                    by
        			&lt;/td&gt;
        			&lt;td align="right"&gt;
        			${user.name}
         			&lt;/td&gt;
        			&lt;/tr&gt;        			
					&lt;/table&gt;
      			</footer>
	        </javadoc>
    </target>

	
    <target name="build" description="build project" depends="init,recompile,copy4jar,createjar,copy,delete_inproject"/>

    <target name="init" description="initial conditions">
        <property name="classpath" value="classesBuild"/>
    	<property name="buildpath" value="build"/>
        <property name="deploy" value="${windows.disk.prefix}/nfs/infdbs/WissProj/KDD-Framework/archive/version-${now}"/>
        <property name="jarFile" value="kdd.jar"/>
        <property name="main-class" value="de.lmu.ifi.dbs.algorithm.KDDTask"/>
        <property name="source" value="src"/>
        <mkdir dir="${deploy}"/>
        <delete file="${jarFile}"/>
        <delete dir="${buildpath}"/>
        <delete dir="${classpath}"/>
    </target>
    
    <target name="recompile" description="cleaning up classpath, recompiling all classes" depends="init">
        <delete dir="${classpath}"/>
        <mkdir dir="${classpath}"/>
        <path id="compileClasspath">
            <dirset dir="${source}"/>
        </path>

        <javac destdir="${classpath}">
            <classpath refid="compileClasspath"/>
            <exclude name="*.xml"/>
            <exclude name="*.html"/>
            <exclude name="*.jar"/>
            <exclude name="*.xsd"/>
            <src path="${source}"/>
        </javac>
    </target>

    <target name="copy4jar" description="copies all classes and descriptors together" depends="init">
        <copy todir="${buildpath}">
        	<fileset dir="bin">
                <exclude name="**/*.class"/>
            </fileset>
            <fileset dir="${classpath}"/>
        </copy>
        <copy todir="${buildpath}/de">
        	<fileset dir="${source}/de">
        		<exclude name="**/*.java"/>
        	</fileset>
        </copy>
        <copy todir="${buildpath}/src/de">
            <fileset dir="${source}/de" />
        </copy>
        <!-- insert patterns to exclude respective classes from deployment -->
    	<!--
        <delete>
	        <fileset dir="build" includes="**/Hierarchical4C*,**/H4C*"/>
        </delete>
        -->
    </target>

    <target name="createjar" description="creates jar file in base dir" depends="init, copy4jar">
        <jar basedir="${buildpath}/" jarfile="${jarFile}">
            <manifest>
                <attribute name="Main-class" value="${main-class}"/>
            </manifest>
        </jar>
    </target>
	
    <target name="copy" description="copies everything to a local copy of the directory" depends="init, createjar">
        <copy todir="${deploy}">
            <fileset file="${jarFile}"/>
        </copy>
    </target>
    
    <target name="delete_inproject" description="deletes temporary paths and jar file in project path" depends="init">
        <delete file="${jarFile}"/>
        <delete dir="${buildpath}"/>
        <delete dir="${classpath}"/>
    </target>

	<!--
    <target name="copy non-java-stuff" description="get all non-java-stuff from archive" depends="">
    	<copy todir="bin">
    		<fileset dir="/home/wiss5/zimek/work/ML/ENDs/archive/open-version">
    			<exclude name="**/*.class"/>
    			<exclude name="**/*.tmp"/>
    			<exclude name="**/*.jar"/>
    			<exclude name="**/*.props"/>
    			<exclude name="src/**/*"/>
    			<exclude name="META*/**/*"/>    			
    		</fileset>
    	</copy>
    </target>
     -->

</project>